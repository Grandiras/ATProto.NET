name: Sync to Forgejo

on:
  push:
    branches: [main]

jobs:
  sync:
    # Only run for commits NOT coming from the Forgejo push mirror.
    # The mirror pushes use the Forgejo bot account; regular merges use the GitHub user.
    if: github.actor != 'forgejo-mirror[bot]'
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Push to Forgejo
        run: |
          git remote add forgejo https://Grandiras:${{ secrets.FORGEJO_TOKEN }}@git.grandiras.net/Grandiras/ATProto.NET.git
          git push forgejo main --tags
